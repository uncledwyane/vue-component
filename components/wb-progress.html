<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>进度条</title>
    <link rel="stylesheet" href="../styles/wb-progress.css">
    <link rel="stylesheet" href="../styles/wb-button.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12"></script>
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
    <style>
    </style>
</head>

<body>
    <div id="app">
        <!-- <div class="bar_box">
            <div class="bar_progress" :style="{width: barWidth + 'px'}"></div>
            <div class="bar_bg"></div>
        </div> -->
        <div class="notify">KeyCode: <span style="color: green; font-weight: bolder;">{{keyCode}}</span>  Key: <span style="color: red; font-weight: bolder;">{{key}}</span></div>
        <div class="progress">
            <wb-progress :percentage="progressNum" :color="'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'"></wb-progress>
            <!-- <wb-progress :percentage="progressNum" :color="'#67c23a'"></wb-progress>
            <wb-progress :percentage="progressNum" :color="'#e6a23c'"></wb-progress>
            <wb-progress :percentage="progressNum" :color="'#f56c6c'"></wb-progress> -->
        </div>
        <div class="option">
            <wb-button @click="progressStart('reduce')" type="main">Decrease</wb-button>
            <wb-button @click="progressStart('add')" type="danger">Increase</wb-button>
        </div>
    </div>
    <script>
        Vue.config.devtools = true;

        Vue.component('wb-progress', {
            props: ['percentage', 'width', 'color'],
            data() {
                return {
                    mode: 'unable', // play mode:  pause start
                    duration: '3:53', // 音乐时间长度
                    durationToSeconds: 0, // 音乐时间长度转化为秒
                    barGrowth: 0, // 进度条每秒步进的长度
                    growthTimer: null, // 步进的轮训
                    dropTimer: null // 步减的轮训
                }
            },
            created() {
                let self = this;
            },
            watch: {
                mode(val, oldval){
                }
            },
            computed: {
                barStyle() {
                    const self = this;
                    const style = {};
                    style.width = self.percentage + '%';
                    style.background = self.color;
                    return style;
                },
                barSpotStyle() {
                    const self = this;
                    const style = {};
                    style.background = self.color;
                    return style;
                }
            },
            mounted() {
                var self = this;
            },
            methods: {
                
            },
            template: `
                <div class="wb-progress-bar">
                    <div class="wb-bar-bg">
                        <div class="wb-bar-progress" :style="barStyle">
                            <span class="wb-bar-progress-spot" :style="barSpotStyle"></span>
                        </div>
                    </div>
                </div>
            `
        })

        Vue.component('wb-button', {
            props: {
                type: {
                    type: String,
                    default: 'default'
                },
                round: Boolean,
                circle: Boolean
            },
            created() {
                const self = this
            },
            data() {
                return {
                }
            },
            methods: {
                handleClick(evt) {
                    const self = this
                    self.$emit('click', evt)
                }
            },
            template: `
                <button class="wb-button" :class="[{'is-round': round}, {'is-circle': circle}, type ? 'wb-button-' + type : '']" @click="handleClick" >
                    <span v-if="$slots.default"><slot></slot></span>
                </button>
            `
        })

        /**
         * 步进值始终为1
         * 考虑根据总时长和进度条长度之间的关系来算出步进的频率
         **/
        var vm = new Vue({
            el:'#app',
            data:{
                progressNum: 10,
                notifyEl: $('.notify')[0],
                barWidth: 0, // 进度条长度
                // barBgWidth: $('.bar_bg')[0].offsetWidth, // 进度条背景总长度，用于计算步进值
                key: "",
                keyCode: "", 
                mode: 'pause', // play mode:  pause start
                duration: '3:53', // 音乐时间长度
                durationToSeconds: 0, // 音乐时间长度转化为秒
                barGrowth: 0, // 进度条每秒步进的长度
                growthTimer: null, // 步进的轮训
                dropTimer: null // 步减的轮训
            },
            created() {
                var self = this;
                window.onkeypress = self.onKeyPressHandle;
            },
            mounted() {
                var self = this;

            },
            methods:{
                clickHandle(type) {
                    var self = this;
                    if(type === 'add' && self.progressNum + 1 <= 100){
                        self.progressNum += 1;
                    }else if(type === 'reduce' && self.progressNum - 1 >= 0){
                        self.progressNum -= 1;
                    }else{}
                },
                onKeyPressHandle(e){
                    var self = this;
                    if(e.keyCode === 32){
                        if(self.mode === 'pause'){
                            self.mode = 'start'
                        }else{
                            self.mode = 'pause'
                        }
                    }

                    self.notify({
                        key: e.key,
                        keyCode: e.keyCode
                    })
                },
                notify(content){
                    let self = this;
                    let {key, keyCode} = content;
                    self.key = key;
                    self.keyCode = keyCode;
                },
                
                progressStart(type) {
                    var self = this;
                    
                    var i = 0;
                    if(type !== 'add' && type !== 'reduce'){
                        return;
                    }
                    if(self.dropTimer){
                        clearTimeout(self.dropTimer);
                        self.dropTimer = null;
                    }
                    if(self.growthTimer){
                        clearTimeout(self.growthTimer);
                        self.growthTimer = null;
                    }
                    self.growthTimer = setInterval(() => {
                       self.clickHandle(type)
                    }, 1000);
                }
            }
        });
    </script>
</body>

</html>